<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Muri Muri — Café</title>
<meta name="description" content="Muri Muri — café de especialidad en Coyoacán, CDMX." />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<style>
  :root{ --bg:#FFF7F2; --ink:#0f0f0f; --accent:#eaad96; --muted:#6a6a6a; --max:1180px }
  *{ box-sizing:border-box }
  body{ margin:0; background:var(--bg); color:var(--ink); line-height:1.6; font-family: system-ui,-apple-system,Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif }
  a{ color:inherit; text-decoration:none }
  .wrap{ max-width:var(--max); margin:0 auto; padding:0 20px }
  header{ position:sticky; top:0; z-index:20; background:rgba(255,255,255,.85); backdrop-filter: saturate(1.2) blur(8px); border-bottom:1px solid rgba(0,0,0,.06) }
  .nav{ display:grid; grid-template-columns:1fr auto 1fr; align-items:center; height:68px }
  .nav a{ font-weight:600 }
  .brand .wordmark{ font-weight:800; letter-spacing:.06em }
  #playfield{ position:relative; height:min(64vh,600px); min-height:420px; margin:18px auto 8px; max-width:var(--max); border-radius:20px; overflow:hidden; }
  #logo{ position:absolute; left:0; top:0; width:clamp(360px,72vw,920px); user-select:none; -webkit-user-drag:none; cursor:pointer; filter:drop-shadow(0 8px 24px rgba(0,0,0,.22)); }
  @media (max-width:640px){ #logo{ width:86vw } }
  .photo{ position:absolute; object-fit:contain; width:260px; height:260px; background:#fff; border:1px solid rgba(0,0,0,.08); box-shadow:0 10px 30px rgba(0,0,0,.12); opacity:0; transition:opacity .6s ease; pointer-events:auto; border-radius:16px }
  .photo.show{ opacity:1 }
  .photo .cap{ position:absolute; left:10px; bottom:10px; padding:6px 10px; border-radius:999px; background:rgba(234,173,150,.95); color:#000; font-weight:700; font-size:.9rem }
  .btn{ display:inline-flex; align-items:center; gap:8px; padding:12px 18px; border-radius:999px; border:1px solid rgba(0,0,0,.12); font-weight:600 }
  .btn.primary{ background:var(--accent); border-color:transparent; color:#000 }
  footer{ padding:36px 0 48px; border-top:1px solid rgba(0,0,0,.06) }
  .grid{ display:grid; gap:18px; grid-template-columns:2fr 1fr 1fr }
  .tiny{ font-size:.92rem; color:var(--muted) }
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; padding:20px; z-index:50 }
  .modal.open{ display:flex }
  .sheet{ background:#fff; border-radius:16px; max-width:980px; width:100%; box-shadow:0 20px 60px rgba(0,0,0,.28); overflow:hidden }
  .viewer{ position:relative; width:100%; background:#fff }
  .viewer .fit{ height:min(92vh,800px); width:100%; display:flex; align-items:center; justify-content:center; background:#fff }
  .viewer img,.viewer iframe{ max-width:100%; max-height:100%; border:0 }
  .viewer iframe{ display:none }
  .viewer .chrome{ position:absolute; top:8px; left:8px; right:8px; display:flex; justify-content:space-between; pointer-events:none }
  .viewer .btnIcon{ pointer-events:auto; -webkit-tap-highlight-color:transparent; background:rgba(255,255,255,.95); border:1px solid rgba(0,0,0,.12); border-radius:999px; width:42px; height:42px; display:grid; place-items:center; font-size:22px; font-weight:800 }
  .viewer .group{ display:flex; gap:8px }
  #runner{ width:100%; height:auto; display:block; max-width:960px; margin:0 auto }
</style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div><a class="brand" href="#top"><span class="wordmark" id="brand">MURI MURI</span></a></div>
      <nav><a href="#" id="contactBtn">CONTACTO</a></nav>
      <div style="text-align:right"><a id="igTop" href="#" target="_blank" rel="noopener">INSTAGRAM</a></div>
    </div>
  </header>

  <main id="top">
    <section id="playfield" aria-label="Área interactiva">
      <img id="logo" alt="Muri Muri">
    </section>

    <div class="wrap" id="unlocked" style="display:none">
      <p>
        <a class="btn" id="btnEmail" href="#">email</a>
        <a class="btn" id="btnWA" href="#" target="_blank" rel="noopener">WhatsApp</a>
        <a class="btn primary" href="#" id="openMenu">Menú</a>
      </p>

      <section style="padding:0 0 40px">
        <canvas id="runner" width="960" height="260" aria-label="Juego: salta con espacio o toque"></canvas>
        <div class="tiny">Espacio o toque para saltar. Enter para reiniciar.</div>
      </section>

      <footer>
        <div class="grid">
          <div>
            <div class="brand"><span class="wordmark" id="brandFoot">MURI MURI</span></div>
            <p class="tiny">© <span id="year"></span> <span id="brandLegal">Muri Muri</span>. Todos los derechos reservados.</p>
          </div>
          <div>
            <strong>Síguenos</strong>
            <p><a id="igFoot" href="#" target="_blank" rel="noopener">@murimuricafe</a></p>
          </div>
          <div>
            <strong>Contacto</strong>
            <p id="addr"></p>
            <p id="hours"></p>
          </div>
        </div>
      </footer>
    </div>
  </main>

  <div class="modal" id="modal" aria-modal="true" role="dialog">
    <div class="sheet"><div class="content" id="modalContent"></div></div>
  </div>

<script>
const $  = (s,root=document)=>root.querySelector(s);
const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
const html = (str)=>{ const t=document.createElement('template'); t.innerHTML=str.trim(); return t.content.firstElementChild; };

const App = {
  state: null,
  init(){
    fetch('content.json').then(r=>r.json()).then(cfg=>{
      this.state = cfg;
      this.applyTheme(cfg);
      this.loadFonts(cfg);
      this.buildStatic(cfg);
      this.buildPlayfield(cfg);
      this.bindUI(cfg);
      this.year();
    }).catch(e=>{
      console.error('content.json missing?', e);
      alert('Falta content.json o tiene un error.');
    });
  },
  applyTheme({theme}){
    const r = document.documentElement.style;
    r.setProperty('--bg', theme?.bg || '#FFF7F2');
    r.setProperty('--ink', theme?.ink || '#0f0f0f');
    r.setProperty('--accent', theme?.accent || '#eaad96');
    r.setProperty('--muted', theme?.muted || '#6a6a6a');
    r.setProperty('--max', (theme?.maxWidth||1180) + 'px');
    document.body.style.background = theme?.bg || '#FFF7F2';
  },
  loadFonts({fonts}){
    if(!fonts) return;
    const s = document.createElement('style');
    s.innerHTML = `
      ${fonts.display ? \`@font-face{font-family:'\${fonts.display.name}'; src:url('\${fonts.display.src}') format('\${fonts.display.src.lower().endswith(".otf") and "opentype" or "truetype"}'); font-weight:\${fonts.display.weight or 700}; font-style:\${fonts.display.style or "normal"}; font-display:swap}\` : ""}
    `;
    document.head.appendChild(s);
    if(fonts.body){
      const s2 = document.createElement('style');
      s2.innerHTML = \`@font-face{font-family:'\${fonts.body.name}'; src:url('\${fonts.body.src}') format('\${fonts.body.src.toLowerCase().endsWith(".otf")?"opentype":"truetype"}'); font-weight:\${fonts.body.weight||400}; font-style:\${fonts.body.style||"normal"}; font-display:swap}\`;
      document.head.appendChild(s2);
      document.body.style.fontFamily = '\''+fonts.body.name+'\', system-ui, -apple-system, Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif';
    }
    if(fonts.display){ $$('#brand, #brandFoot').forEach(el=> el.style.fontFamily = '\''+fonts.display.name+'\', '+getComputedStyle(el).fontFamily)); }
  },
  buildStatic({brand, contact, logo}){
    $('#brand').textContent = brand || 'MURI MURI';
    $('#brandFoot').textContent = brand || 'MURI MURI';
    $('#brandLegal').textContent = brand || 'Muri Muri';
    $('#igTop').href  = contact?.instagram || '#';
    $('#igFoot').href = contact?.instagram || '#';
    try { $('#igFoot').textContent = '@' + (new URL(contact?.instagram)).pathname.replace(/\//g,''); } catch {}
    $('#btnEmail').href = \`mailto:\${contact?.email}\`; $('#btnEmail').textContent = contact?.email || '';
    $('#btnWA').href = contact?.whatsapp || '#'; $('#btnWA').textContent = \`WhatsApp \${contact?.phone||''}\`;
    $('#addr').innerHTML = \`\${(contact?.address_lines||[]).map(l=>\`<div>\${l}</div>\`).join('')}<div style="margin-top:10px"><a class="btn" href="mailto:\${contact?.email}">\${contact?.email||''}</a></div><div style="margin-top:10px"><a class="btn primary" href="\${contact?.whatsapp||'#'}" target="_blank" rel="noopener">\${contact?.phone||''}</a></div>\`;
    $('#hours').innerHTML = (contact?.hours||[]).map(h=> \`<div>\${h.label}: \${h.value}</div>\`).join('');
    const logoEl = $('#logo');
    if(logo?.src){ logoEl.src = logo.src; logoEl.alt = brand || 'MURI MURI'; }
    else { logoEl.remove(); }
  },
  buildPlayfield({images, effects}){
    const field = $('#playfield');
    (images||[]).slice(0,8).forEach((it,i)=>{
      const fig = html(\`<figure class="photo" data-i="\${i}"><img alt="\${it.label||''}" src="\${it.src}" style="width:100%;height:100%;object-fit:contain;border-radius:16px">\${it.label?\`<figcaption class="cap">\${it.label}</figcaption>\`:''}</figure>\`);
      if(it.action) fig.dataset.open = it.action;
      field.appendChild(fig);
    });
    const nodes = $$('.photo', field);
    const VIS = (effects?.bubbles?.visibleSeconds||10) * 1000;
    const BASE = (effects?.bubbles?.baseIntervalSeconds||10) * 1000;
    function place(el){
      const fw = field.clientWidth, fh = field.clientHeight;
      const w = 220 + Math.floor(Math.random()*140);
      const h = w;
      const x = Math.max(0, Math.floor(Math.random()*(fw - w)));
      const y = Math.max(0, Math.floor(Math.random()*(fh - h)));
      el.style.width = w+'px'; el.style.height = h+'px'; el.style.left = x+'px'; el.style.top = y+'px';
    }
    function show(el){ place(el); el.classList.add('show'); setTimeout(()=> el.classList.remove('show'), VIS); }
    nodes.forEach((n,i)=> setTimeout(()=> show(n), i*250));
    nodes.forEach((n, i)=>{
      const t = (i+1)*BASE;
      setTimeout(()=> setInterval(()=> show(n), t), t);
      const k = n.dataset.open; if(k) n.onclick = ()=> App.openModal(k);
    });
    this.startBounce($('#logo'), field, effects?.bounce);
    let opened=false, gameInited=false;
    $('#logo')?.addEventListener('click', ()=>{
      if(!opened){ $('#unlocked').style.display='block'; opened=true; }
      if(!gameInited){ this.initRunner(effects?.game); gameInited=true; }
      $('#runner')?.parentElement?.parentElement?.scrollIntoView({behavior:'smooth'});
    });
  },
  startBounce(el, field, bounce){
    if(!el || !field) return;
    let vx = (bounce?.vx)||3.2, vy=(bounce?.vy)||3.0;
    let x = 20, y = 20, lw=el.offsetWidth||600, lh=el.offsetHeight||200;
    function measure(){ const r=el.getBoundingClientRect(); if(r.width){ lw=r.width; lh=r.height; } }
    el.addEventListener('load', measure); setTimeout(measure, 150);
    (function step(){
      const fw=field.clientWidth, fh=field.clientHeight;
      x += vx; y += vy;
      if(x<=0 || x+lw>=fw) vx *= -1;
      if(y<=0 || y+lh>=fh) vy *= -1;
      el.style.transform = \`translate(\${x}px,\${y}px)\`;
      requestAnimationFrame(step);
    })();
  },
  bindUI(cfg){
    const modal = $('#modal'), content = $('#modalContent');
    modal.addEventListener('click', e=>{ if(e.target===modal) modal.classList.remove('open'); });
    $('#contactBtn').addEventListener('click', (e)=>{ e.preventDefault(); this.openModal('contact'); });
    $('#openMenu').addEventListener('click', (e)=>{ e.preventDefault(); this.openModal('menu'); });
    this.openModal = (kind)=>{
      modal.classList.add('open'); content.innerHTML='';
      if(kind==='map'){
        const q = encodeURIComponent(cfg?.contact?.mapQuery || '');
        content.appendChild(html(\`<div class="viewer"><div class="fit"><iframe src="https://www.google.com/maps?q=\${q}&output=embed" style="display:block"></iframe></div></div>\`));
      } else if(kind==='contact'){
        const c = cfg.contact||{};
        content.appendChild(html(\`<div class="viewer"><div class="fit" style="padding:20px;align-items:flex-start"><div><h3 style="margin:0 0 8px">\${cfg.brand||'MURI MURI'}</h3>\${(c.address_lines||[]).map(l=>\`<div>\${l}</div>\`).join('')}<div style="margin-top:10px"><a class="btn" href="mailto:\${c.email}">\${c.email||''}</a></div><div style="margin-top:10px"><a class="btn primary" href="\${c.whatsapp||'#'}" target="_blank" rel="noopener">\${c.phone||''}</a></div><div style="margin-top:12px">\${(c.hours||[]).map(h=>\`<div>\${h.label}: \${h.value}</div>\`).join('')}</div></div></div></div>\`));
      } else if(kind==='info'){
        content.appendChild(html(\`<div class="viewer"><div class="fit" style="padding:24px"><p>Café de especialidad en Coyoacán.</p></div></div>\`));
      } else if(kind==='shop'){
        content.appendChild(html(\`<div class="viewer"><div class="fit" style="padding:24px"><p>Próximamente: tienda online.</p></div></div>\`));
      } else if(kind==='menu'){
        this.menuViewer(cfg.menu?.pages||[]);
      }
    };
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') $('#modal').classList.remove('open'); });
  },
  menuViewer(pages){
    const modal = $('#modal'), content = $('#modalContent');
    let idx = 0;
    content.innerHTML = \`<div class="viewer"><div class="chrome"><div class="group"><button class="btnIcon" id="mPrev" aria-label="Anterior">‹</button><button class="btnIcon" id="mNext" aria-label="Siguiente">›</button></div><button class="btnIcon" id="mClose" aria-label="Cerrar">×</button></div><div class="fit"><img id="menuImg" alt="Menú" /><iframe id="menuPdf"></iframe></div></div>\`;
    const img = $('#menuImg', content), pdf=$('#menuPdf', content);
    function show(i){
      if(!pages.length) return;
      idx = (i + pages.length) % pages.length;
      img.style.display='none'; pdf.style.display='none';
      img.src = (pages[idx].img||'') + (pages[idx].img ? \`?v=\${Date.now()}\`:'');
      img.onload = ()=> img.style.display='block';
      img.onerror = ()=> { if(pages[idx].pdf){ pdf.src = pages[idx].pdf + '#toolbar=0&navpanes=0&scrollbar=0&statusbar=0&messages=0'; pdf.style.display='block'; } };
    }
    $('#mPrev',content).onclick = ()=> show(idx-1);
    $('#mNext',content).onclick = ()=> show(idx+1);
    $('#mClose',content).onclick = ()=> modal.classList.remove('open');
    let sx=0, fit=$('.fit', content);
    fit.addEventListener('touchstart', e=> sx=e.changedTouches[0].clientX, {passive:true});
    fit.addEventListener('touchend', e=>{ const dx=e.changedTouches[0].clientX - sx; if(Math.abs(dx)>40) (dx>0? show(idx-1): show(idx+1)); }, {passive:true});
    const onKey = (e)=>{ if(e.key==='ArrowLeft') show(idx-1); if(e.key==='ArrowRight') show(idx+1); };
    document.addEventListener('keydown', onKey, {once:false});
    show(0);
  },
  initRunner(gameCfg){
    const cvs=$('#runner'); const ctx=cvs.getContext('2d');
    let running=true; const G=0.6, JUMP=-11; const ground=cvs.height-28;
    const player={x:80, y:ground, vy:0, w:56, h:56}; let obstacles=[];
    const speed = (gameCfg?.speed)||5.2;
    const sprite=new Image(); sprite.src='assets/recurso.png';
    const bean=new Image();   bean.src='assets/bean.png';
    function reset(){ player.y=ground; player.vy=0; obstacles=[]; running=true; }
    function spawn(){ const sz=26+Math.random()*14; obstacles.push({x:cvs.width+20,y:ground,w:sz,h:sz,size:sz}); }
    let gap=0;
    function draw(){
      ctx.clearRect(0,0,cvs.width,cvs.height);
      ctx.strokeStyle='rgba(0,0,0,.15)'; ctx.beginPath(); ctx.moveTo(0,ground+2); ctx.lineTo(cvs.width,ground+2); ctx.stroke();
      if(sprite.complete&&sprite.naturalWidth){ ctx.drawImage(sprite, player.x-14, player.y-player.h, player.w, player.h); }
      else{ ctx.fillStyle='#935c4d'; ctx.fillRect(player.x, player.y-player.h, player.w, player.h); }
      obstacles.forEach(o=>{ if(bean.complete&&bean.naturalWidth) ctx.drawImage(bean, o.x-o.size/2, o.y-o.size, o.size, o.size); else { ctx.fillStyle='#6b3e2e'; ctx.beginPath(); ctx.ellipse(o.x,o.y-o.size/2,o.size/2.4,o.size/1.9,.4,0,Math.PI*2); ctx.fill(); } });
    }
    function update(){
      if(!running) return;
      player.vy+=G; player.y+=player.vy; if(player.y>ground){ player.y=ground; player.vy=0; }
      obstacles.forEach(o=> o.x-=speed); obstacles=obstacles.filter(o=> o.x+o.w>0);
      gap-=speed; if(gap<=0){ spawn(); gap=240+Math.random()*220; }
      for(const o of obstacles){ if(player.x<o.x+o.w && player.x+player.w>o.x && player.y>o.y-o.h){ running=false; } }
    }
    (function loop(){ update(); draw(); requestAnimationFrame(loop); })();
    function jump(){ if(player.y===ground) player.vy=JUMP; }
    cvs.addEventListener('pointerdown', jump);
    document.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ e.preventDefault(); jump(); } if(e.code==='Enter'&&!running){ reset(); } });
    cvs.addEventListener('click', ()=>{ if(!running) reset(); });
  },
  year(){ const y=$('#year'); if(y) y.textContent = new Date().getFullYear(); }
};
document.addEventListener('DOMContentLoaded', ()=> App.init());
</script>
</body>
</html>
